(function(a){ColVis=function(c,b){if(!this.CLASS||this.CLASS!="ColVis"){alert("Warning: ColVis must be initialised with the keyword 'new'")}if(typeof b=="undefined"){b={}}this.s={dt:null,oInit:b,fnStateChange:null,activate:"click",sAlign:"left",buttonText:"Show / hide columns",hidden:true,aiExclude:[],abOriginal:[],bShowAll:false,sShowAll:"Show All",bRestore:false,sRestore:"Restore original",iOverlayFade:500,fnLabel:null,sSize:"auto",bCssPosition:false};this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[],restore:null};ColVis.aInstances.push(this);this.s.dt=c;this._fnConstruct();return this};ColVis.prototype={fnRebuild:function(){for(var b=this.dom.buttons.length-1;b>=0;b--){if(this.dom.buttons[b]!==null){this.dom.collection.removeChild(this.dom.buttons[b])}}this.dom.buttons.splice(0,this.dom.buttons.length);if(this.dom.restore){this.dom.restore.parentNode(this.dom.restore)}this._fnAddButtons();this._fnDrawCallback()},_fnConstruct:function(){this._fnApplyCustomisation();var d=this;var c,b;this.dom.wrapper=document.createElement("div");this.dom.wrapper.className="ColVis TableTools";this.dom.button=this._fnDomBaseButton(this.s.buttonText);this.dom.button.className+=" ColVis_MasterButton";this.dom.wrapper.appendChild(this.dom.button);this.dom.catcher=this._fnDomCatcher();this.dom.collection=this._fnDomCollection();this.dom.background=this._fnDomBackground();this._fnAddButtons();for(c=0,b=this.s.dt.aoColumns.length;c<b;c++){this.s.abOriginal.push(this.s.dt.aoColumns[c].bVisible)}this.s.dt.aoDrawCallback.push({fn:function(){d._fnDrawCallback.call(d)},sName:"ColVis"});a(this.s.dt.oInstance).bind("column-reorder",function(i,h,g){for(c=0,b=d.s.aiExclude.length;c<b;c++){d.s.aiExclude[c]=g.aiInvertMapping[d.s.aiExclude[c]]}var f=d.s.abOriginal.splice(g.iFrom,1)[0];d.s.abOriginal.splice(g.iTo,0,f);d.fnRebuild()})},_fnApplyCustomisation:function(){var b=this.s.oInit;if(typeof b.activate!="undefined"){this.s.activate=b.activate}if(typeof b.buttonText!="undefined"){this.s.buttonText=b.buttonText}if(typeof b.aiExclude!="undefined"){this.s.aiExclude=b.aiExclude}if(typeof b.bRestore!="undefined"){this.s.bRestore=b.bRestore}if(typeof b.sRestore!="undefined"){this.s.sRestore=b.sRestore}if(typeof b.bShowAll!="undefined"){this.s.bShowAll=b.bShowAll}if(typeof b.sShowAll!="undefined"){this.s.sShowAll=b.sShowAll}if(typeof b.sAlign!="undefined"){this.s.sAlign=b.sAlign}if(typeof b.fnStateChange!="undefined"){this.s.fnStateChange=b.fnStateChange}if(typeof b.iOverlayFade!="undefined"){this.s.iOverlayFade=b.iOverlayFade}if(typeof b.fnLabel!="undefined"){this.s.fnLabel=b.fnLabel}if(typeof b.sSize!="undefined"){this.s.sSize=b.sSize}if(typeof b.bCssPosition!="undefined"){this.s.bCssPosition=b.bCssPosition}},_fnDrawCallback:function(){var c=this.s.dt.aoColumns;for(var d=0,b=c.length;d<b;d++){if(this.dom.buttons[d]!==null){if(c[d].bVisible){a("input",this.dom.buttons[d]).attr("checked","checked")}else{a("input",this.dom.buttons[d]).removeAttr("checked")}}}},_fnAddButtons:function(){var e,c=","+this.s.aiExclude.join(",")+",";for(var d=0,b=this.s.dt.aoColumns.length;d<b;d++){if(c.indexOf(","+d+",")==-1){e=this._fnDomColumnButton(d);this.dom.buttons.push(e);this.dom.collection.appendChild(e)}else{this.dom.buttons.push(null)}}if(this.s.bRestore){e=this._fnDomRestoreButton();e.className+=" ColVis_Restore";this.dom.buttons.push(e);this.dom.collection.appendChild(e)}if(this.s.bShowAll){e=this._fnDomShowAllButton();e.className+=" ColVis_ShowAll";this.dom.buttons.push(e);this.dom.collection.appendChild(e)}},_fnDomRestoreButton:function(){var d=this,c=document.createElement("button"),b=document.createElement("span");c.className=!this.s.dt.bJUI?"ColVis_Button TableTools_Button":"ColVis_Button TableTools_Button ui-button ui-state-default";c.appendChild(b);a(b).html('<span class="ColVis_title">'+this.s.sRestore+"</span>");a(c).click(function(h){for(var g=0,f=d.s.abOriginal.length;g<f;g++){d.s.dt.oInstance.fnSetColumnVis(g,d.s.abOriginal[g],false)}d._fnAdjustOpenRows();d.s.dt.oInstance.fnAdjustColumnSizing(false);d.s.dt.oInstance.fnDraw(false)});return c},_fnDomShowAllButton:function(){var d=this,c=document.createElement("button"),b=document.createElement("span");c.className=!this.s.dt.bJUI?"ColVis_Button TableTools_Button":"ColVis_Button TableTools_Button ui-button ui-state-default";c.appendChild(b);a(b).html('<span class="ColVis_title">'+this.s.sShowAll+"</span>");a(c).click(function(h){for(var g=0,f=d.s.abOriginal.length;g<f;g++){if(d.s.aiExclude.indexOf(g)===-1){d.s.dt.oInstance.fnSetColumnVis(g,true,false)}}d._fnAdjustOpenRows();d.s.dt.oInstance.fnAdjustColumnSizing(false);d.s.dt.oInstance.fnDraw(false)});return c},_fnDomColumnButton:function(d){var g=this,h=this.s.dt.aoColumns[d],e=document.createElement("button"),c=document.createElement("span"),f=this.s.dt;e.className=!f.bJUI?"ColVis_Button TableTools_Button":"ColVis_Button TableTools_Button ui-button ui-state-default";e.appendChild(c);var b=this.s.fnLabel===null?h.sTitle:this.s.fnLabel(d,h.sTitle,h.nTh);a(c).html('<span class="ColVis_radio"><input type="checkbox"/></span><span class="ColVis_title">'+b+"</span>");a(e).click(function(i){var j=!a("input",this).is(":checked");if(i.target.nodeName.toLowerCase()=="input"){j=a("input",this).is(":checked")}g.s.abOriginal[d]=j;var k=a.fn.dataTableExt.iApiIndex;a.fn.dataTableExt.iApiIndex=g._fnDataTablesApiIndex.call(g);if(f.oFeatures.bServerSide&&(f.oScroll.sX!==""||f.oScroll.sY!=="")){g.s.dt.oInstance.fnSetColumnVis(d,j,false);g.s.dt.oInstance.fnAdjustColumnSizing(false);g.s.dt.oInstance.oApi._fnScrollDraw(g.s.dt);g._fnDrawCallback()}else{g.s.dt.oInstance.fnSetColumnVis(d,j)}a.fn.dataTableExt.iApiIndex=k;if(g.s.fnStateChange!==null){g.s.fnStateChange.call(g,d,j)}});return e},_fnDataTablesApiIndex:function(){for(var c=0,b=this.s.dt.oInstance.length;c<b;c++){if(this.s.dt.oInstance[c]==this.s.dt.nTable){return c}}return 0},_fnDomBaseButton:function(f){var d=this,c=document.createElement("button"),b=document.createElement("span"),e=this.s.activate=="mouseover"?"mouseover":"click";c.className=!this.s.dt.bJUI?"ColVis_Button TableTools_Button":"ColVis_Button TableTools_Button ui-button ui-state-default";c.appendChild(b);b.innerHTML=f;a(c).bind(e,function(g){d._fnCollectionShow();g.preventDefault()});return c},_fnDomCollection:function(){var b=this;var c=document.createElement("div");c.style.display="none";c.className=!this.s.dt.bJUI?"ColVis_collection TableTools_collection":"ColVis_collection TableTools_collection ui-buttonset ui-buttonset-multi";if(!this.s.bCssPosition){c.style.position="absolute"}a(c).css("opacity",0);return c},_fnDomCatcher:function(){var c=this,b=document.createElement("div");b.className="ColVis_catcher TableTools_catcher";a(b).click(function(){c._fnCollectionHide.call(c,null,null)});return b},_fnDomBackground:function(){var c=this;var b=document.createElement("div");b.style.position="absolute";b.style.left="0px";b.style.top="0px";b.className="ColVis_collectionBackground TableTools_collectionBackground";a(b).css("opacity",0);a(b).click(function(){c._fnCollectionHide.call(c,null,null)});if(this.s.activate=="mouseover"){a(b).mouseover(function(){c.s.overcollection=false;c._fnCollectionHide.call(c,null,null)})}return b},_fnCollectionShow:function(){var m=this,h,f;var p=a(this.dom.button).offset();var g=this.dom.collection;var d=this.dom.background;var c=parseInt(p.left,10);var b=parseInt(p.top+a(this.dom.button).outerHeight(),10);if(!this.s.bCssPosition){g.style.top=b+"px";g.style.left=c+"px"}g.style.display="block";a(g).css("opacity",0);var l=a(window).height(),j=a(document).height(),k=a(window).width(),o=a(document).width();d.style.height=((l>j)?l:j)+"px";d.style.width=((k<o)?k:o)+"px";var r=this.dom.catcher.style;r.height=a(this.dom.button).outerHeight()+"px";r.width=a(this.dom.button).outerWidth()+"px";r.top=p.top+"px";r.left=c+"px";document.body.appendChild(d);document.body.appendChild(g);document.body.appendChild(this.dom.catcher);if(this.s.sSize=="auto"){var n=[];this.dom.collection.style.width="auto";for(h=0,f=this.dom.buttons.length;h<f;h++){if(this.dom.buttons[h]!==null){this.dom.buttons[h].style.width="auto";n.push(a(this.dom.buttons[h]).outerWidth())}}iMax=Math.max.apply(window,n);for(h=0,f=this.dom.buttons.length;h<f;h++){if(this.dom.buttons[h]!==null){this.dom.buttons[h].style.width=iMax+"px"}}this.dom.collection.style.width=iMax+"px"}if(!this.s.bCssPosition){g.style.left=this.s.sAlign=="left"?c+"px":(c-a(g).outerWidth()+a(this.dom.button).outerWidth())+"px";var e=a(g).outerWidth();var q=a(g).outerHeight();if(c+e>o){g.style.left=(o-e)+"px"}}setTimeout(function(){a(g).animate({opacity:1},m.s.iOverlayFade);a(d).animate({opacity:0.1},m.s.iOverlayFade,"linear")},10);this.s.hidden=false},_fnCollectionHide:function(){var b=this;if(!this.s.hidden&&this.dom.collection!==null){this.s.hidden=true;a(this.dom.collection).animate({opacity:0},b.s.iOverlayFade,function(c){this.style.display="none"});a(this.dom.background).animate({opacity:0},b.s.iOverlayFade,function(c){document.body.removeChild(b.dom.background);document.body.removeChild(b.dom.catcher)})}},_fnAdjustOpenRows:function(){var e=this.s.dt.aoOpenRows;var c=this.s.dt.oApi._fnVisbleColumns(this.s.dt);for(var d=0,b=e.length;d<b;d++){e[d].nTr.getElementsByTagName("td")[0].colSpan=c}}};ColVis.fnRebuild=function(c){var d=null;if(typeof c!="undefined"){d=c.fnSettings().nTable}for(var e=0,b=ColVis.aInstances.length;e<b;e++){if(typeof c=="undefined"||d==ColVis.aInstances[e].s.dt.nTable){ColVis.aInstances[e].fnRebuild()}}};ColVis.aInstances=[];ColVis.prototype.CLASS="ColVis";ColVis.VERSION="1.0.8";ColVis.prototype.VERSION=ColVis.VERSION;if(typeof a.fn.dataTable=="function"&&typeof a.fn.dataTableExt.fnVersionCheck=="function"&&a.fn.dataTableExt.fnVersionCheck("1.7.0")){a.fn.dataTableExt.aoFeatures.push({fnInit:function(d){var c=(typeof d.oInit.oColVis=="undefined")?{}:d.oInit.oColVis;var b=new ColVis(d,c);return b.dom.wrapper},cFeature:"C",sFeature:"ColVis"})}else{alert("Warning: ColVis requires DataTables 1.7 or greater - www.datatables.net/download")}})(jQuery);