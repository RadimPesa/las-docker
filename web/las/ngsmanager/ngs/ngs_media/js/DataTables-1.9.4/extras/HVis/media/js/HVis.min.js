(function(a){HVis=function(c,b){if(!this.CLASS||this.CLASS!="HVis"){alert("Warning: HVis must be initialised with the keyword 'new'")}if(typeof b=="undefined"){b={}}this.s={dt:null,oInit:b,fnStateChange:null,activate:"click",sAlign:"left",buttonText:"Highlight columns",hidden:true,aiExclude:[],abOriginal:[],bShowAll:false,sShowAll:"Show All",bRestore:false,sRestore:"Restore original",iOverlayFade:500,fnLabel:null,sSize:"auto",bCssPosition:false,mColumns:"visible"};this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[],restore:null};HVis.aInstances.push(this);this.s.dt=c;this._fnConstruct();return this};HVis.prototype={fnRebuild:function(){for(var b=this.dom.buttons.length-1;b>=0;b--){if(this.dom.buttons[b]!==null){this.dom.collection.removeChild(this.dom.buttons[b])}}this.dom.buttons.splice(0,this.dom.buttons.length);if(this.dom.restore){this.dom.restore.parentNode(this.dom.restore)}this._fnAddButtons();this._fnDrawCallback()},_fnConstruct:function(){this._fnApplyCustomisation();var d=this;var c,b;this.dom.wrapper=document.createElement("div");this.dom.wrapper.className="HVis TableTools";this.dom.button=this._fnDomBaseButton(this.s.buttonText);this.dom.button.className+=" HVis_MasterButton";this.dom.wrapper.appendChild(this.dom.button);this.dom.catcher=this._fnDomCatcher();this.dom.collection=this._fnDomCollection();this.dom.background=this._fnDomBackground();this._fnAddButtons();for(c=0,b=this.s.dt.aoColumns.length;c<b;c++){this.s.abOriginal.push(false)}this.s.dt.aoDrawCallback.push({fn:function(){d._fnDrawCallback.call(d)},sName:"HVis"});a(this.s.dt.oInstance).bind("column-reorder",function(j,h,g){for(c=0,b=d.s.aiExclude.length;c<b;c++){d.s.aiExclude[c]=g.aiInvertMapping[d.s.aiExclude[c]]}var f=d.s.abOriginal.splice(g.iFrom,1)[0];d.s.abOriginal.splice(g.iTo,0,f);d.fnRebuild()})},_fnApplyCustomisation:function(){var b=this.s.oInit;if(typeof b.activate!="undefined"){this.s.activate=b.activate}if(typeof b.buttonText!="undefined"){this.s.buttonText=b.buttonText}if(typeof b.aiExclude!="undefined"){this.s.aiExclude=b.aiExclude}if(typeof b.bRestore!="undefined"){this.s.bRestore=b.bRestore}if(typeof b.sRestore!="undefined"){this.s.sRestore=b.sRestore}if(typeof b.bShowAll!="undefined"){this.s.bShowAll=b.bShowAll}if(typeof b.sShowAll!="undefined"){this.s.sShowAll=b.sShowAll}if(typeof b.sAlign!="undefined"){this.s.sAlign=b.sAlign}if(typeof b.fnStateChange!="undefined"){this.s.fnStateChange=b.fnStateChange}if(typeof b.iOverlayFade!="undefined"){this.s.iOverlayFade=b.iOverlayFade}if(typeof b.fnLabel!="undefined"){this.s.fnLabel=b.fnLabel}if(typeof b.sSize!="undefined"){this.s.sSize=b.sSize}if(typeof b.bCssPosition!="undefined"){this.s.bCssPosition=b.bCssPosition}},_fnDrawCallback:function(){var c=this.s.dt.aoColumns;for(var d=0,b=c.length;d<b;d++){if(this.dom.buttons[d]!==null){if(this.s.abOriginal[d]){a("input",this.dom.buttons[d]).prop("checked",true)}else{a("input",this.dom.buttons[d]).prop("checked",false)}}}},_fnAddButtons:function(){var e,c=","+this.s.aiExclude.join(",")+",";for(var d=0,b=this.s.dt.aoColumns.length;d<b;d++){if(c.indexOf(","+d+",")==-1){e=this._fnDomColumnButton(d);this.dom.buttons.push(e);this.dom.collection.appendChild(e)}else{this.dom.buttons.push(null)}}if(this.s.bRestore){e=this._fnDomRestoreButton();e.className+=" HVis_Restore";this.dom.buttons.push(e);this.dom.collection.appendChild(e)}if(this.s.bShowAll){e=this._fnDomShowAllButton();e.className+=" HVis_ShowAll";this.dom.buttons.push(e);this.dom.collection.appendChild(e)}},_fnDomRestoreButton:function(){var d=this,c=document.createElement("button"),b=document.createElement("span");c.className=!this.s.dt.bJUI?"HVis_Button TableTools_Button":"HVis_Button TableTools_Button ui-button ui-state-default";c.appendChild(b);a(b).html('<span class="HVis_title">'+this.s.sRestore+"</span>");a(c).click(function(f){d._fnSetSelection();d._fnAdjustOpenRows();d.s.dt.oInstance.fnAdjustColumnSizing(false);d.s.dt.oInstance.fnDraw(false)});return c},_fnDomShowAllButton:function(){var d=this,c=document.createElement("button"),b=document.createElement("span");c.className=!this.s.dt.bJUI?"HVis_Button TableTools_Button":"HVis_Button TableTools_Button ui-button ui-state-default";c.appendChild(b);a(b).html('<span class="HVis_title">'+this.s.sShowAll+"</span>");a(c).click(function(h){for(var g=0,f=d.s.abOriginal.length;g<f;g++){if(d.s.aiExclude.indexOf(g)===-1){d._fnSetSelection()}}d._fnAdjustOpenRows();d.s.dt.oInstance.fnAdjustColumnSizing(false);d.s.dt.oInstance.fnDraw(false)});return c},_fnColumnTargets:function(b){var d=[];var c=this.s.dt;if(typeof b=="object"){for(i=0,iLen=c.aoColumns.length;i<iLen;i++){d.push(false)}for(i=0,iLen=b.length;i<iLen;i++){d[b[i]]=true}}else{if(b=="visible"){for(i=0,iLen=c.aoColumns.length;i<iLen;i++){d.push(c.aoColumns[i].bVisible?true:false)}}else{if(b=="hidden"){for(i=0,iLen=c.aoColumns.length;i<iLen;i++){d.push(c.aoColumns[i].bVisible?false:true)}}else{if(b=="sortable"){for(i=0,iLen=c.aoColumns.length;i<iLen;i++){d.push(c.aoColumns[i].bSortable?true:false)}}else{for(i=0,iLen=c.aoColumns.length;i<iLen;i++){d.push(true)}}}}}return d},_fnSetSelection:function(){var f,e,c,g,d;var b=this._fnColumnTargets(this.s.mColumns);for(f=0,c=this.s.dt.aoData.length;f<c;f++){d=0;for(e=0,g=this.s.dt.aoColumns.length;e<g;e++){if(b[e]){if(this.s.abOriginal[e]){a(this.s.dt.aoData[f].nTr.cells[d]).addClass("highsel")}else{a(this.s.dt.aoData[f].nTr.cells[d]).removeClass("highsel")}d++}}}},_fnDomColumnButton:function(d){var g=this,h=this.s.dt.aoColumns[d],e=document.createElement("button"),c=document.createElement("span"),f=this.s.dt;e.className=!f.bJUI?"HVis_Button TableTools_Button":"HVis_Button TableTools_Button ui-button ui-state-default";e.appendChild(c);var b=this.s.fnLabel===null?h.sTitle:this.s.fnLabel(d,h.sTitle,h.nTh);a(c).html('<span class="HVis_radio"><input type="checkbox"/></span><span class="HVis_title">'+b+"</span>");a(e).click(function(j){var k=!a("input",this).is(":checked");if(j.target.nodeName.toLowerCase()=="input"){k=a("input",this).is(":checked")}g.s.abOriginal[d]=k;var l=a.fn.dataTableExt.iApiIndex;a.fn.dataTableExt.iApiIndex=g._fnDataTablesApiIndex.call(g);if(f.oFeatures.bServerSide&&(f.oScroll.sX!==""||f.oScroll.sY!=="")){g._fnSetSelection();g.s.dt.oInstance.fnAdjustColumnSizing(false);g.s.dt.oInstance.oApi._fnScrollDraw(g.s.dt)}else{g._fnSetSelection()}g._fnDrawCallback();a.fn.dataTableExt.iApiIndex=l;if(g.s.fnStateChange!==null){g.s.fnStateChange.call(g,d,k)}});return e},_fnDataTablesApiIndex:function(){for(var c=0,b=this.s.dt.oInstance.length;c<b;c++){if(this.s.dt.oInstance[c]==this.s.dt.nTable){return c}}return 0},_fnDomBaseButton:function(f){var d=this,c=document.createElement("button"),b=document.createElement("span"),e=this.s.activate=="mouseover"?"mouseover":"click";c.className=!this.s.dt.bJUI?"HVis_Button TableTools_Button":"HVis_Button TableTools_Button ui-button ui-state-default";c.appendChild(b);b.innerHTML=f;a(c).bind(e,function(g){d._fnCollectionShow();g.preventDefault()});return c},_fnDomCollection:function(){var b=this;var c=document.createElement("div");c.style.display="none";c.className=!this.s.dt.bJUI?"HVis_collection TableTools_collection":"HVis_collection TableTools_collection ui-buttonset ui-buttonset-multi";if(!this.s.bCssPosition){c.style.position="absolute"}a(c).css("opacity",0);return c},_fnDomCatcher:function(){var c=this,b=document.createElement("div");b.className="HVis_catcher TableTools_catcher";a(b).click(function(){c._fnCollectionHide.call(c,null,null)});return b},_fnDomBackground:function(){var c=this;var b=document.createElement("div");b.style.position="absolute";b.style.left="0px";b.style.top="0px";b.className="HVis_collectionBackground TableTools_collectionBackground";a(b).css("opacity",0);a(b).click(function(){c._fnCollectionHide.call(c,null,null)});if(this.s.activate=="mouseover"){a(b).mouseover(function(){c.s.overcollection=false;c._fnCollectionHide.call(c,null,null)})}return b},_fnCollectionShow:function(){var n=this,j,f;var q=a(this.dom.button).offset();var h=this.dom.collection;var d=this.dom.background;var c=parseInt(q.left,10);var b=parseInt(q.top+a(this.dom.button).outerHeight(),10);if(!this.s.bCssPosition){h.style.top=b+"px";h.style.left=c+"px"}h.style.display="block";a(h).css("opacity",0);var m=a(window).height(),k=a(document).height(),l=a(window).width(),p=a(document).width();d.style.height=((m>k)?m:k)+"px";d.style.width=((l<p)?l:p)+"px";var s=this.dom.catcher.style;s.height=a(this.dom.button).outerHeight()+"px";s.width=a(this.dom.button).outerWidth()+"px";s.top=q.top+"px";s.left=c+"px";document.body.appendChild(d);document.body.appendChild(h);document.body.appendChild(this.dom.catcher);var g=this._fnColumnTargets(this.s.mColumns);for(j=0,f=this.dom.buttons.length;j<f;j++){if(this.dom.buttons[j]!=null){if(g[j]){this.dom.buttons[j].style.display=""}else{this.dom.buttons[j].style.display="none"}}}if(this.s.sSize=="auto"){var o=[];this.dom.collection.style.width="auto";for(j=0,f=this.dom.buttons.length;j<f;j++){if(this.dom.buttons[j]!==null){this.dom.buttons[j].style.width="auto";o.push(a(this.dom.buttons[j]).outerWidth())}}iMax=Math.max.apply(window,o);for(j=0,f=this.dom.buttons.length;j<f;j++){if(this.dom.buttons[j]!==null){this.dom.buttons[j].style.width=iMax+"px"}}this.dom.collection.style.width=iMax+"px"}if(!this.s.bCssPosition){h.style.left=this.s.sAlign=="left"?c+"px":(c-a(h).outerWidth()+a(this.dom.button).outerWidth())+"px";var e=a(h).outerWidth();var r=a(h).outerHeight();if(c+e>p){h.style.left=(p-e)+"px"}}setTimeout(function(){a(h).animate({opacity:1},n.s.iOverlayFade);a(d).animate({opacity:0.1},n.s.iOverlayFade,"linear")},10);this.s.hidden=false},_fnCollectionHide:function(){var b=this;if(!this.s.hidden&&this.dom.collection!==null){this.s.hidden=true;a(this.dom.collection).animate({opacity:0},b.s.iOverlayFade,function(c){this.style.display="none"});a(this.dom.background).animate({opacity:0},b.s.iOverlayFade,function(c){document.body.removeChild(b.dom.background);document.body.removeChild(b.dom.catcher)})}},_fnAdjustOpenRows:function(){var e=this.s.dt.aoOpenRows;var c=this.s.dt.oApi._fnVisbleColumns(this.s.dt);for(var d=0,b=e.length;d<b;d++){e[d].nTr.getElementsByTagName("td")[0].colSpan=c}}};HVis.fnRebuild=function(c){var d=null;if(typeof c!="undefined"){d=c.fnSettings().nTable}for(var e=0,b=HVis.aInstances.length;e<b;e++){if(typeof c=="undefined"||d==HVis.aInstances[e].s.dt.nTable){HVis.aInstances[e].fnRebuild()}}};HVis.aInstances=[];HVis.prototype.CLASS="HVis";HVis.VERSION="1.0.8";HVis.prototype.VERSION=HVis.VERSION;if(typeof a.fn.dataTable=="function"&&typeof a.fn.dataTableExt.fnVersionCheck=="function"&&a.fn.dataTableExt.fnVersionCheck("1.7.0")){a.fn.dataTableExt.aoFeatures.push({fnInit:function(d){var c=(typeof d.oInit.oHVis=="undefined")?{}:d.oInit.oHVis;var b=new HVis(d,c);return b.dom.wrapper},cFeature:"H",sFeature:"HVis"})}else{alert("Warning: HVis requires DataTables 1.7 or greater - www.datatables.net/download")}})(jQuery);